<template>
  <div class="theme-settings-container">
    <el-card class="header-card">
      <template #header>
        <div class="card-header">
          <span>ä¸»é¢˜è®¾ç½®</span>
          <el-button type="primary" @click="saveSettings">
            <el-icon><Check /></el-icon>
            ä¿å­˜è®¾ç½®
          </el-button>
        </div>
      </template>

      <el-alert
        title="ä¸»é¢˜è¯´æ˜"
        type="info"
        :closable="false"
        style="margin-bottom: 20px"
      >
        <p>ç®¡ç†å‘˜è®¾ç½®çš„ä¸»é¢˜ä¼˜å…ˆçº§é«˜äºç”¨æˆ·é€‰æ‹©ï¼Œå°†è¦†ç›–æ‰€æœ‰ç”¨æˆ·çš„ä¸»é¢˜è®¾ç½®</p>
        <p>é€‰æ‹©"ç”¨æˆ·è‡ªé€‰"æ—¶ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡é¦–é¡µå³ä¸Šè§’çš„æ‹‰ç»³åˆ‡æ¢æ·±è‰²/æµ…è‰²ä¸»é¢˜</p>
      </el-alert>

      <el-form :model="form" label-width="120px">
        <el-form-item label="å½“å‰ä¸»é¢˜">
          <el-radio-group v-model="form.theme" size="large">
            <el-radio-button label="user-choice">
              <el-icon><User /></el-icon>
              ç”¨æˆ·è‡ªé€‰
            </el-radio-button>
            <el-radio-button label="light">
              <el-icon><Sunny /></el-icon>
              æµ…è‰²ä¸»é¢˜
            </el-radio-button>
            <el-radio-button label="dark">
              <el-icon><Moon /></el-icon>
              æ·±è‰²ä¸»é¢˜
            </el-radio-button>
            <el-radio-button label="gray">
              <el-icon><Warning /></el-icon>
              ç°è‰²ä¸»é¢˜
            </el-radio-button>
            <el-radio-button label="christmas">
              <el-icon><Present /></el-icon>
              åœ£è¯ä¸»é¢˜
            </el-radio-button>
            <el-radio-button label="spring-festival">
              <el-icon><Coin /></el-icon>
              æ˜¥èŠ‚ä¸»é¢˜
            </el-radio-button>
          </el-radio-group>
        </el-form-item>

        <el-form-item label="ä¸»é¢˜é¢„è§ˆ">
          <div class="theme-preview-grid">
            <!-- ç”¨æˆ·è‡ªé€‰ -->
            <div 
              :class="['theme-preview-card', { active: form.theme === 'user-choice' }]"
              @click="form.theme = 'user-choice'"
            >
              <div class="preview-header">
                <el-icon><User /></el-icon>
                <span>ç”¨æˆ·è‡ªé€‰</span>
              </div>
              <div class="preview-content user-choice">
                <div class="preview-section light-section">æµ…è‰²</div>
                <div class="preview-section dark-section">æ·±è‰²</div>
              </div>
              <div class="preview-desc">ç”¨æˆ·å¯è‡ªç”±åˆ‡æ¢æ·±è‰²/æµ…è‰²</div>
            </div>

            <!-- æµ…è‰²ä¸»é¢˜ -->
            <div 
              :class="['theme-preview-card', { active: form.theme === 'light' }]"
              @click="form.theme = 'light'"
            >
              <div class="preview-header">
                <el-icon><Sunny /></el-icon>
                <span>æµ…è‰²ä¸»é¢˜</span>
              </div>
              <div class="preview-content light-theme">
                <div class="preview-box"></div>
                <div class="preview-box"></div>
                <div class="preview-box"></div>
              </div>
              <div class="preview-desc">æ˜äº®æ¸…çˆ½çš„ç™½è‰²ä¸»é¢˜</div>
            </div>

            <!-- æ·±è‰²ä¸»é¢˜ -->
            <div 
              :class="['theme-preview-card', { active: form.theme === 'dark' }]"
              @click="form.theme = 'dark'"
            >
              <div class="preview-header">
                <el-icon><Moon /></el-icon>
                <span>æ·±è‰²ä¸»é¢˜</span>
              </div>
              <div class="preview-content dark-theme">
                <div class="preview-box"></div>
                <div class="preview-box"></div>
                <div class="preview-box"></div>
              </div>
              <div class="preview-desc">æŠ¤çœ¼èˆ’é€‚çš„é»‘è‰²ä¸»é¢˜</div>
            </div>

            <!-- ç°è‰²ä¸»é¢˜ -->
            <div 
              :class="['theme-preview-card', { active: form.theme === 'gray' }]"
              @click="form.theme = 'gray'"
            >
              <div class="preview-header">
                <el-icon><Warning /></el-icon>
                <span>ç°è‰²ä¸»é¢˜</span>
              </div>
              <div class="preview-content gray-theme">
                <div class="preview-box"></div>
                <div class="preview-box"></div>
                <div class="preview-box"></div>
              </div>
              <div class="preview-desc">é»˜å“€æ¨¡å¼ï¼Œæ‰€æœ‰è‰²å½©å¤±æ•ˆ</div>
            </div>

            <!-- åœ£è¯ä¸»é¢˜ -->
            <div 
              :class="['theme-preview-card', { active: form.theme === 'christmas' }]"
              @click="form.theme = 'christmas'"
            >
              <div class="preview-header">
                <el-icon><Present /></el-icon>
                <span>åœ£è¯ä¸»é¢˜</span>
              </div>
              <div class="preview-content christmas-theme">
                <div class="christmas-hat">ğŸ…</div>
                <div class="christmas-gift">ğŸ</div>
                <div class="christmas-tree">ğŸ„</div>
              </div>
              <div class="preview-desc">åœ£è¯å¸½+ç¤¼ç‰©é£˜è½ç‰¹æ•ˆ</div>
            </div>

            <!-- æ˜¥èŠ‚ä¸»é¢˜ -->
            <div 
              :class="['theme-preview-card', { active: form.theme === 'spring-festival' }]"
              @click="form.theme = 'spring-festival'"
            >
              <div class="preview-header">
                <el-icon><Coin /></el-icon>
                <span>æ˜¥èŠ‚ä¸»é¢˜</span>
              </div>
              <div class="preview-content spring-festival-theme">
                <div class="spring-item">ğŸ§§</div>
                <div class="spring-item">ğŸ®</div>
                <div class="spring-item">ğŸ§¨</div>
              </div>
              <div class="preview-desc">çº¢è‰²ä¸»é¢˜+çº¢åŒ…é£˜è½+é­ç‚®</div>
            </div>
          </div>
        </el-form-item>
      </el-form>
    </el-card>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import { ElMessage } from 'element-plus'
import { Check, User, Sunny, Moon, Warning, Present, Coin } from '@element-plus/icons-vue'
import { getConfig, updateConfig } from '../api/config'

const form = ref({
  theme: 'user-choice'
})

const loadSettings = async () => {
  try {
    const res = await getConfig()
    if (res.data) {
      // éå†æ‰€æœ‰åˆ†ç±»æŸ¥æ‰¾site.themeé…ç½®
      for (const category in res.data) {
        const configs = res.data[category]
        const themeConfig = configs.find(c => c.configKey === 'site.theme')
        if (themeConfig) {
          form.value.theme = themeConfig.configValue || 'user-choice'
          break
        }
      }
    }
  } catch (error) {
    console.error('åŠ è½½ä¸»é¢˜è®¾ç½®å¤±è´¥', error)
  }
}

const saveSettings = async () => {
  try {
    await updateConfig({
      'site.theme': form.value.theme
    })
    ElMessage.success('ä¸»é¢˜è®¾ç½®å·²ä¿å­˜')
  } catch (error) {
    console.error('ä¿å­˜ä¸»é¢˜è®¾ç½®å¤±è´¥', error)
    ElMessage.error('ä¿å­˜å¤±è´¥')
  }
}

onMounted(() => {
  loadSettings()
})
</script>

<style scoped>
.theme-settings-container {
  padding: 20px;
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.theme-preview-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 20px;
  margin-top: 20px;
}

@media (max-width: 1200px) {
  .theme-preview-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 768px) {
  .theme-preview-grid {
    grid-template-columns: 1fr;
  }
}

.theme-preview-card {
  border: 2px solid #e0e6ed;
  border-radius: 12px;
  padding: 16px;
  cursor: pointer;
  transition: all 0.3s ease;
  background: white;
}

.theme-preview-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.theme-preview-card.active {
  border-color: #409eff;
  box-shadow: 0 4px 12px rgba(64, 158, 255, 0.3);
}

.preview-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 12px;
  font-weight: 600;
  color: #333;
}

.preview-content {
  height: 100px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  margin-bottom: 12px;
}

.user-choice {
  background: linear-gradient(90deg, #f5f5f5 50%, #1a1a1a 50%);
}

.light-section,
.dark-section {
  flex: 1;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  font-weight: 600;
}

.light-section {
  color: #333;
}

.dark-section {
  color: #e0e0e0;
}

.light-theme {
  background: #f5f5f5;
}

.dark-theme {
  background: #1a1a1a;
}

.gray-theme {
  background: #808080;
  filter: grayscale(100%);
}

.christmas-theme {
  background: linear-gradient(135deg, #c41e3a 0%, #165b33 100%);
}

.spring-festival-theme {
  background: linear-gradient(135deg, #ff0000 0%, #ffd700 100%);
}

.preview-box {
  width: 20px;
  height: 20px;
  border-radius: 4px;
}

.light-theme .preview-box {
  background: white;
  border: 1px solid #e0e6ed;
}

.dark-theme .preview-box {
  background: #2d2d2d;
  border: 1px solid #404040;
}

.gray-theme .preview-box {
  background: #666;
}

.christmas-hat,
.christmas-gift,
.christmas-tree,
.spring-item {
  font-size: 28px;
  animation: float 2s ease-in-out infinite;
}

.christmas-gift {
  animation-delay: 0.3s;
}

.christmas-tree {
  animation-delay: 0.6s;
}

.spring-item:nth-child(2) {
  animation-delay: 0.3s;
}

.spring-item:nth-child(3) {
  animation-delay: 0.6s;
}

@keyframes float {
  0%, 100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-10px);
  }
}

.preview-desc {
  font-size: 12px;
  color: #999;
  text-align: center;
}
</style>
